<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/vendor/modernizr.js"></script>
   <script src="https://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
   <script type="text/javascript" src="https://www.google.com/jsapi"></script>
   <script src="render.js"></script>
   <title>Apache Project Report Helper: Add a release</title>
</head>
<body onload='GetAsyncJSON("/releases/" + project + ".json?now=" + Math.random(), null, listReleaseData)'>

<div id="contents" class="row-12" style="margin: 0 auto; width: 1000px; ">
  <h2 style="text-align: center;">Apache Committee Report Helper: Add a release</h2>
  <p>Please fill out the fields below to add a release to our report database. This is not a requirement, but a help to those that use the Apache Reporter System to gauge the committee's development.</p>
   <form action="addrelease.py" method="post" id="form" onsubmit="return validate(this)">
    
    <input type="hidden" name="date" value="" id="date"/>
    <b>Committee:</b></b><input type="text" name="committee" value="" readonly="readonly" id="committee"/><br/>
    <b>Full version name:</b></b><input type="text" name="version" value="" placeholder="1.2.0" id="version"/><br/>
    <b>Date of release (YYYY-MM-DD):</b></b><input type="text" name="xdate" value="" placeholder="YYYY-MM-DD" id="xdate"/><br/>
    <input type="submit" value="Add release data"/><br>
    <small>Need to remove a release? Enter the version of the release and 1970-01-01 as the date then!</small>
   </form>
</div>
<div id="footer">
   Copyright&copy; 2015, the Apache Software Foundation. Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a><br/>
   For inquiries, contact <a href="mailto:dev@community.apache.org">dev@community.apache.org</a>.
</div>
    <script src="js/foundation.min.js"></script>
    
    <script>
     var committee = document.location.search.substr(1);
     document.getElementById('committee').value = committee;
     var date = new Date();
     var xdate = document.getElementById('xdate');
     var done = false;
     xdate.value = date.getFullYear() + "-" + ((date.getMonth()+1) < 10? "0"+(date.getMonth()+1) : (date.getMonth()+1)) + "-" + ((date.getDay()+1) < 10? "0"+(date.getDay()+1) : (date.getDay()+1))
     
     function validate(form) {
      var x = document.getElementById('xdate').value.split("-");
      var y = new Date(x[0],parseInt(x[1])-1,parseInt(x[2]));
      var nn = parseInt(y.getTime()/1000);
      document.getElementById('date').value = nn;
      if (isNaN(nn)) {
        alert("Please fill out the release date using YYYY-MMM-DD!")
        return false
      }
      return true
     }
     
     function listReleaseData(json, a,b) {
      if (done) {
        return;
      }
      done = true
      var obj = document.getElementById('contents')
      var x = 0;
      obj.innerHTML += "<h3>Already registered releases:</h3>"
      for (version in json) {
        if (new Date(json[version]*1000) > new Date(1999,1,1)) {
          obj.innerHTML += "- " + version + ": " + new Date(json[version]*1000).toDateString() + "<br/>"
          x++;
        }
        
      }
      if (x == 0) {
        obj.innerHTML += "No releases registered yet"
      }
      document.getElementById('committee').value = committee;
     }
     
    </script>
</body>
</html>
